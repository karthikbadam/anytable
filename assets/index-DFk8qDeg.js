import{l as h,o as _,d as y,X as S,f as A,A as P,N as D,J as j,i as q,a as k,b as x,c as B}from"./index-MxFKUvIB.js";import{C as ue,P as le,e as he,j as fe,q as de,s as pe}from"./index-MxFKUvIB.js";import{r as I,s as L,p as R,c as U}from"./string-x_hxqRJt.js";const v={};function F(r,e=!1){let t,n,s=v;function i(c){t=r(c).catch(()=>{}).finally(()=>{if(n){const{value:u}=n;n=null,i(u)}else t=null})}function o(c){n={event:c}}function a(c){t?o(c):i(c)}function l(c){s!==c&&requestAnimationFrame(()=>{const u=s;s=v,a(u)}),s=c}return e?l:a}class G{constructor(e){this._filterBy=e,this._requestUpdate=F(()=>this.requestQuery(),!0),this._coordinator=null}get coordinator(){return this._coordinator}set coordinator(e){this._coordinator=e}get filterBy(){return this._filterBy}get filterStable(){return!0}fields(){return null}fieldInfo(e){return this}query(e){return null}queryPending(){return this}queryResult(e){return this}queryError(e){return this}requestQuery(e){var n;const t=e||this.query((n=this.filterBy)==null?void 0:n.predicate(this));return this._coordinator.requestQuery(this,t)}requestUpdate(){this._requestUpdate()}initialize(){return this._coordinator.initializeClient(this)}update(){return this}}class Q{constructor(){this._callbacks=new Map}addEventListener(e,t){this._callbacks.has(e)||this._callbacks.set(e,{callbacks:new Set,pending:null,queue:new T}),this._callbacks.get(e).callbacks.add(t)}removeEventListener(e,t){const n=this._callbacks.get(e);n&&n.callbacks.delete(t)}willEmit(e,t){return t}emitQueueFilter(e,t){return null}cancel(e){const t=this._callbacks.get(e);t==null||t.queue.clear()}async pending(e){var t;await((t=this._callbacks.get(e))==null?void 0:t.pending)}emit(e,t){const n=this._callbacks.get(e)||{};if(n.pending)n.queue.enqueue(t,this.emitQueueFilter(e,t));else{const s=this.willEmit(e,t),{callbacks:i,queue:o}=n;if(i!=null&&i.size){const a=Array.from(i,l=>l(s));n.pending=Promise.allSettled(a).then(()=>{n.pending=null,o.isEmpty()||this.emit(e,o.dequeue())})}}}}class T{constructor(){this.clear()}clear(){this.next=null}isEmpty(){return!this.next}enqueue(e,t){const n={value:e};if(t&&this.next){let s=this;for(;s.next;)t(s.next.value)?s=s.next:s.next=s.next.next;s.next=n}else this.next=n}dequeue(){const{next:e}=this;return this.next=e==null?void 0:e.next,e==null?void 0:e.value}}function M(r,e){return r===e?!1:r instanceof Date&&e instanceof Date?+r!=+e:Array.isArray(r)&&Array.isArray(e)?O(r,e):!0}function O(r,e){if(r.length!==e.length)return!0;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!0;return!1}function m(r){return r instanceof f}class f extends Q{constructor(e){super(),this._value=e}static value(e){return new f(e)}static array(e){if(e.some(t=>m(t))){const t=new f,n=()=>{t.update(e.map(s=>m(s)?s.value:s))};return n(),e.forEach(s=>m(s)?s.addEventListener("value",n):0),t}return new f(e)}get value(){return this._value}update(e,{force:t}={}){return M(this._value,e)||t?this.emit("value",e):this.cancel("value"),this}willEmit(e,t){return e==="value"&&(this._value=t),t}}function K(r){return r instanceof p}function d(r,e){return new p(new b(r),e&&[e].flat())}class p extends f{static intersect({cross:e=!1,empty:t=!1,include:n=[]}={}){return d({cross:e,empty:t},n)}static union({cross:e=!1,empty:t=!1,include:n=[]}={}){return d({cross:e,empty:t,union:!0},n)}static single({cross:e=!1,empty:t=!1,include:n=[]}={}){return d({cross:e,empty:t,single:!0},n)}static crossfilter({empty:e=!1,include:t=[]}={}){return d({cross:!0,empty:e},t)}constructor(e=new b,t=[]){if(super([]),this._resolved=this._value,this._resolver=e,this._relay=new Set,Array.isArray(t))for(const n of t)n._relay.add(this)}clone(){const e=new p(this._resolver);return e._value=e._resolved=this._value,e}remove(e){const t=this.clone();return t._value=t._resolved=t._resolver.resolve(this._resolved,{source:e}),t._value.active={source:e},t}get resolver(){return this._resolver}get single(){return this._resolver.single}get clauses(){return super.value}get active(){return this.clauses.active}get value(){var e;return(e=this.active)==null?void 0:e.value}valueFor(e){var t;return(t=this.clauses.find(n=>n.source===e))==null?void 0:t.value}activate(e){this.emit("activate",e),this._relay.forEach(t=>t.activate(e))}update(e){return this._resolved=this._resolver.resolve(this._resolved,e,!0),this._resolved.active=e,this._relay.forEach(t=>t.update(e)),super.update(this._resolved)}willEmit(e,t){return e==="value"?(this._value=t,this.value):t}emitQueueFilter(e,t){return e==="value"?this._resolver.queueFilter(t):null}skip(e,t){return this._resolver.skip(e,t)}predicate(e,t=!1){const{clauses:n}=this,s=t?null:n.active;return this._resolver.predicate(n,s,e)}}class b{constructor({union:e,cross:t,single:n,empty:s}={}){this.union=!!e,this.cross=!!t,this.single=!!n,this.empty=!!s}resolve(e,t,n=!1){const{source:s,predicate:i}=t,o=e.filter(l=>s!==l.source),a=this.single?[]:o;return this.single&&n&&o.forEach(l=>{var c,u;return(u=(c=l.source)==null?void 0:c.reset)==null?void 0:u.call(c)}),i&&a.push(t),a}skip(e,t){var n;return this.cross&&((n=t==null?void 0:t.clients)==null?void 0:n.has(e))}predicate(e,t,n){const{empty:s,union:i}=this;if(s&&!e.length)return[h(!1)];if(this.skip(n,t))return;const o=e.filter(a=>!this.skip(n,a)).map(a=>a.predicate);return i&&o.length>1?_(o):o}queueFilter(e){var t;if(this.cross){const n=(t=e.active)==null?void 0:t.source;return s=>{var i;return((i=s.active)==null?void 0:i.source)!==n}}return null}}function Y(r="http://localhost:3000/"){return{async query(e){const t=fetch(r,{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return e.type==="exec"?t:e.type==="arrow"?y(await(await t).arrayBuffer()):(await t).json()}}}function z(r,e){return new Promise((t,n)=>{r.useUnsafe(async(s,i)=>{try{const o=await s.runQuery(i,e);t(o)}catch(o){n(o)}})})}function Z(r={}){const{duckdb:e,connection:t,...n}=r;let s=e,i=t,o;function a(){return o||(o=(s?Promise.resolve(s):N(n).then(u=>s=u)).then(u=>u.connect()).then(u=>i=u)),o}async function l(){return s||await a(),s}async function c(){return i||await a(),i}return{getDuckDB:l,getConnection:c,query:async u=>{const{type:g,sql:E}=u,C=await c(),w=await z(C,E);return g==="exec"?void 0:g==="arrow"?y(w):y(w).toArray()}}}async function N({log:r=!1}={}){const e=j(),t=await S(e),n=URL.createObjectURL(new Blob([`importScripts("${t.mainWorker}");`],{type:"text/javascript"})),s=new Worker(n),i=r?new P:new D,o=new A(i,s);return await o.instantiate(t.mainModule,t.pthreadWorker),URL.revokeObjectURL(n),o}function ee(r,e,{source:t,clients:n=t?new Set([t]):void 0}){const s=e!==void 0?x(r,[h(e)]):null;return{meta:{type:"point"},source:t,clients:n,value:e,predicate:s}}function te(r,e,{source:t,clients:n=t?new Set([t]):void 0}){let s=null;if(e){const i=e.length&&r.length===1?[x(r[0],e.map(o=>h(o[0])))]:e.map(o=>k(o.map((a,l)=>B(r[l],h(a)))));s=e.length===0?h(!1):i.length>1?_(i):i[0]}return{meta:{type:"point"},source:t,clients:n,value:e,predicate:s}}function ne(r,e,{source:t,clients:n=t?new Set([t]):void 0,bin:s,scale:i,pixelSize:o=1}){const a=e!=null?q(r,e):null;return{meta:{type:"interval",scales:i&&[i],bin:s,pixelSize:o},source:t,clients:n,value:e,predicate:a}}function re(r,e,{source:t,clients:n=t?new Set([t]):void 0,bin:s,scales:i=[],pixelSize:o=1}){const a=e!=null?k(r.map((c,u)=>q(c,e[u]))):null;return{meta:{type:"interval",scales:i,bin:s,pixelSize:o},source:t,clients:n,value:e,predicate:a}}const J={contains:U,prefix:R,suffix:L,regexp:I};function se(r,e,{source:t,clients:n=void 0,method:s="contains"}){let i=J[s];const o=e?i(r,h(e)):null;return{meta:{type:"match",method:s},source:t,clients:n,value:e,predicate:o}}function W(r){return typeof(r==null?void 0:r.getChild)=="function"}function ie(){const r=new Set;let e,t=new Promise(n=>e=n);return{pending(n){r.add(n)},ready(n){return r.delete(n),r.size===0},resolve(){t=new Promise(n=>{e(),e=n})},get promise(){return t}}}function oe(r){return W(r)?H(r):V(r)}function H(r){const{numRows:e}=r;return{numRows:e,columns:r.toColumns()}}function V(r){const e=r.length;if(typeof r[0]=="object"){const t=e?Object.keys(r[0]):[],n={};return t.length>0&&t.forEach(s=>{n[s]=r.map(i=>i[s])}),{numRows:e,columns:n}}else return{numRows:e,values:r}}export{ue as Coordinator,G as MosaicClient,f as Param,le as Priority,p as Selection,ne as clauseInterval,re as clauseIntervals,se as clauseMatch,ee as clausePoint,te as clausePoints,he as coordinator,y as decodeIPC,M as distinct,W as isArrowTable,m as isParam,K as isSelection,fe as jsType,de as queryFieldInfo,Y as restConnector,pe as socketConnector,ie as synchronizer,F as throttle,oe as toDataColumns,Z as wasmConnector};
